<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="description" content="PWA –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è —É—á—ë—Ç–∞ –≥–µ–æ–ª–æ–≥–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–± –Ω–∞ –º–µ—Å—Ç–æ—Ä–æ–∂–¥–µ–Ω–∏—è—Ö">
    <meta name="theme-color" content="#208C8D">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Sampling">
    <meta name="camera" content="on">
    <meta name="microphone" content="on">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    
    <link rel="manifest" href="/manifest.json">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 192 192'><rect fill='%23208C8D' width='192' height='192'/><text x='96' y='120' font-size='80' font-weight='bold' fill='white' text-anchor='middle'>‚õè</text></svg>">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 192 192'><rect fill='%23208C8D' width='192' height='192'/><text x='96' y='120' font-size='80' font-weight='bold' fill='white' text-anchor='middle'>‚õè</text></svg>">
    
    <title>Sampling App - –£—á—ë—Ç –ø—Ä–æ–±</title>
    
    <style>
        :root {
            --color-primary: #208C8D;
            --color-success: #27AE60;
            --color-error: #E74C3C;
            --color-warning: #F39C12;
            --color-bg: #F8F9FA;
            --color-surface: #FFFFFF;
            --color-text: #2C3E50;
            --color-text-secondary: #7F8C8D;
            --color-border: #ECF0F1;
            --spacing-xs: 4px;
            --spacing-sm: 8px;
            --spacing-md: 16px;
            --spacing-lg: 24px;
            --spacing-xl: 32px;
            --radius-sm: 6px;
            --radius-md: 8px;
            --radius-lg: 12px;
            --shadow-sm: 0 2px 4px rgba(0,0,0,0.1);
            --shadow-md: 0 4px 12px rgba(0,0,0,0.15);
            --shadow-lg: 0 8px 24px rgba(0,0,0,0.2);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            width: 100%;
            height: 100%;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: var(--color-bg);
            color: var(--color-text);
            overflow-x: hidden;
        }

        body {
            display: flex;
            flex-direction: column;
        }

        .app-container {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            width: 100%;
        }

        .header {
            background: linear-gradient(135deg, var(--color-primary) 0%, #1a6f70 100%);
            color: white;
            padding: var(--spacing-lg) var(--spacing-md);
            box-shadow: var(--shadow-md);
            position: sticky;
            top: 0;
            z-index: 100;
            flex-shrink: 0;
        }

        .header h1 {
            font-size: 24px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .header-status {
            font-size: 12px;
            margin-top: var(--spacing-xs);
            opacity: 0.9;
        }

        .main-content {
            flex: 1;
            overflow-y: auto;
            padding: var(--spacing-md);
            display: grid;
            grid-template-columns: 1fr;
            gap: var(--spacing-md);
            width: 100%;
        }

        /* –ê–î–ê–ü–¢–ò–í–ù–û–°–¢–¨ –î–õ–Ø –†–ê–ó–ù–´–• –≠–ö–†–ê–ù–û–í */
        @media (min-width: 768px) {
            .main-content {
                grid-template-columns: repeat(2, 1fr);
                max-width: 1400px;
                margin: 0 auto;
                width: 100%;
            }
        }

        @media (min-width: 1024px) {
            .main-content {
                grid-template-columns: repeat(3, 1fr);
            }

            .card:first-child {
                grid-column: span 2;
            }
        }

        /* –ü–õ–ê–ù–®–ï–¢ –í –ê–õ–¨–ë–û–ú–ù–û–ú –†–ï–ñ–ò–ú–ï */
        @media (max-height: 500px) and (orientation: landscape) {
            .header {
                padding: var(--spacing-sm) var(--spacing-md);
            }

            .header h1 {
                font-size: 18px;
            }

            .main-content {
                padding: var(--spacing-sm);
                gap: var(--spacing-sm);
            }
        }

        .card {
            background: var(--color-surface);
            border-radius: var(--radius-lg);
            padding: var(--spacing-lg);
            box-shadow: var(--shadow-sm);
            transition: var(--transition);
            border: 1px solid var(--color-border);
        }

        .card:hover {
            box-shadow: var(--shadow-md);
        }

        .card h2 {
            font-size: 18px;
            margin-bottom: var(--spacing-md);
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .camera-container {
            width: 100%;
            height: 300px;
            background: #000;
            border-radius: var(--radius-lg);
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: var(--spacing-md);
            border: 2px solid var(--color-border);
            position: relative;
        }

        .camera-container video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }

        video {
            -webkit-appearance: none;
            -webkit-user-select: none;
        }
</parameter>

        input[type="tel"] {
            font-size: 16px;
        }

        select {
            font-size: 16px;
        }

        .form-group {
            margin-bottom: var(--spacing-md);
        }

        .form-group label {
            display: block;
            margin-bottom: var(--spacing-xs);
            font-weight: 500;
            font-size: 14px;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: var(--spacing-sm) var(--spacing-md);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-sm);
            font-size: 14px;
            font-family: inherit;
            transition: var(--transition);
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: 0 0 0 3px rgba(32, 140, 141, 0.1);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .button-group {
            display: flex;
            gap: var(--spacing-md);
            flex-wrap: wrap;
        }

        button {
            padding: var(--spacing-sm) var(--spacing-md);
            border: none;
            border-radius: var(--radius-sm);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-xs);
            min-height: 44px;
        }

        .btn-primary {
            background: var(--color-primary);
            color: white;
            flex: 1;
            min-width: 100px;
        }

        .btn-primary:hover {
            background: #1a6f70;
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .btn-primary:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: var(--color-bg);
            color: var(--color-text);
            border: 1px solid var(--color-border);
        }

        .btn-secondary:hover {
            background: var(--color-border);
        }

        .btn-success {
            background: var(--color-success);
            color: white;
        }

        .btn-error {
            background: var(--color-error);
            color: white;
        }

        .btn-warning {
            background: var(--color-warning);
            color: white;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .status-badge {
            display: inline-block;
            padding: var(--spacing-xs) var(--spacing-sm);
            border-radius: var(--radius-sm);
            font-size: 12px;
            font-weight: 500;
        }

        .status-online {
            background: rgba(39, 174, 96, 0.2);
            color: var(--color-success);
        }

        .status-offline {
            background: rgba(231, 76, 60, 0.2);
            color: var(--color-error);
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
            margin-top: var(--spacing-md);
            overflow-x: auto;
        }

        .data-table thead {
            background: var(--color-bg);
            border-bottom: 2px solid var(--color-border);
        }

        .data-table th {
            padding: var(--spacing-sm);
            text-align: left;
            font-weight: 600;
        }

        .data-table td {
            padding: var(--spacing-sm);
            border-bottom: 1px solid var(--color-border);
        }

        .data-table tbody tr:hover {
            background: var(--color-bg);
        }

        .alert {
            padding: var(--spacing-md);
            border-radius: var(--radius-md);
            margin-bottom: var(--spacing-md);
            display: flex;
            gap: var(--spacing-md);
            align-items: flex-start;
        }

        .alert-success {
            background: rgba(39, 174, 96, 0.1);
            border-left: 4px solid var(--color-success);
            color: var(--color-success);
        }

        .alert-error {
            background: rgba(231, 76, 60, 0.1);
            border-left: 4px solid var(--color-error);
            color: var(--color-error);
        }

        .alert-info {
            background: rgba(32, 140, 141, 0.1);
            border-left: 4px solid var(--color-primary);
            color: var(--color-primary);
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(0,0,0,0.1);
            border-top-color: var(--color-primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .footer {
            background: var(--color-surface);
            border-top: 1px solid var(--color-border);
            padding: var(--spacing-md);
            text-align: center;
            font-size: 12px;
            color: var(--color-text-secondary);
            flex-shrink: 0;
        }

        .tabs {
            display: flex;
            gap: var(--spacing-sm);
            border-bottom: 2px solid var(--color-border);
            margin-bottom: var(--spacing-md);
            overflow-x: auto;
        }

        .tab {
            padding: var(--spacing-md) var(--spacing-lg);
            border: none;
            background: none;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            color: var(--color-text-secondary);
            border-bottom: 3px solid transparent;
            transition: var(--transition);
            white-space: nowrap;
            min-height: auto;
            padding: var(--spacing-md) var(--spacing-lg);
        }

        .tab.active {
            color: var(--color-primary);
            border-bottom-color: var(--color-primary);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .hidden {
            display: none !important;
        }

        .spinner {
            border: 4px solid var(--color-bg);
            border-top: 4px solid var(--color-primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: var(--spacing-lg) auto;
        }

        .empty-state {
            text-align: center;
            padding: var(--spacing-xl);
            color: var(--color-text-secondary);
        }

        .empty-state-icon {
            font-size: 48px;
            margin-bottom: var(--spacing-md);
        }

        input[type="file"] {
            cursor: pointer;
        }

        .progress-bar {
            width: 100%;
            height: 4px;
            background: var(--color-border);
            border-radius: var(--radius-sm);
            overflow: hidden;
            margin: var(--spacing-md) 0;
        }

        .progress-fill {
            height: 100%;
            background: var(--color-primary);
            transition: width 0.3s ease;
        }

        /* –ú–û–ë–ò–õ–¨–ù–ê–Ø –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–Ø */
        @media (max-width: 480px) {
            .header {
                padding: var(--spacing-md) var(--spacing-sm);
            }

            .header h1 {
                font-size: 20px;
            }

            .card {
                padding: var(--spacing-md);
            }

            .card h2 {
                font-size: 16px;
            }

            .button-group {
                flex-direction: column;
            }

            button {
                width: 100%;
            }

            .data-table {
                font-size: 12px;
            }

            .data-table th,
            .data-table td {
                padding: var(--spacing-xs) var(--spacing-sm);
            }
        }

        /* –î–û–°–¢–ê–¢–û–ß–ù–ê–Ø –®–ò–†–ò–ù–ê –î–õ–Ø –ü–õ–ê–í–ù–û–ì–û –°–ö–†–û–õ–õ–ê */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--color-bg);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--color-border);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--color-text-secondary);
        }
    </style>
</head>
<body>
    <div class="app-container">
        <header class="header">
            <h1>‚õè Sampling App</h1>
            <div class="header-status">
                <span>–°—Ç–∞—Ç—É—Å: </span>
                <span id="online-status" class="status-badge status-offline">–û—Ñ—Ñ–ª–∞–π–Ω</span>
            </div>
        </header>

        <main class="main-content">            <!-- –°–ö–ê–ù–ò–†–û–í–ê–ù–ò–ï –ü–†–û–ë -->
            <div class="card" style="grid-column: span 1; margin-bottom: 0;">
                <h2>‚õè –í–≤–æ–¥ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ–±—ã</h2>
                
                <!-- –ö–ê–ú–ï–†–ê –ò –®–¢–†–ò–•–ö–û–î -->
                <div class="form-group">
                    <label>üì± –ù–û–ú–ï–† –ü–†–û–ë–´ (–°–∫–∞–Ω–∏—Ä—É–µ—Ç—Å—è —à—Ç—Ä–∏—Ö–∫–æ–¥)</label>
                    <div class="camera-container">
                        <video id="video" playsinline webkit-playsinline autoplay muted style="width: 100%; height: 100%; object-fit: cover;"></video>
                        <canvas id="canvas" style="display:none;"></canvas>
                    </div>
</parameter>
                    <input 
                        type="text" 
                        id="barcode-input" 
                        placeholder="–ù–æ–º–µ—Ä –ø—Ä–æ–±—ã –∏–∑ —à—Ç—Ä–∏—Ö–∫–æ–¥–∞ –∏–ª–∏ –≤–≤–µ–¥–∏—Ç–µ –≤—Ä—É—á–Ω—É—é..."
                        autocomplete="off"
                        autofocus
                        style="margin-top: var(--spacing-md);"
                    >
                    <button class="btn-secondary" id="camera-toggle-btn" onclick="initCamera()" style="margin-top: var(--spacing-md); width: 100%; display: none;">
                        üì∑ –í–∫–ª—é—á–∏—Ç—å –∫–∞–º–µ—Ä—É
                    </button>
                </div>

                <!-- –°–ö–í–ê–ñ–ò–ù–ê -->
                <div class="form-group">
                    <label>‚õè –°–ö–í–ê–ñ–ò–ù–ê</label>
                    <input 
                        type="tel" 
                        id="manual-well" 
                        placeholder="–ù–æ–º–µ—Ä —Å–∫–≤–∞–∂–∏–Ω—ã"
                        inputmode="numeric"
                    >
                </div>

                <!-- –ë–õ–û–ö -->
                <div class="form-group">
                    <label>üìç –ë–õ–û–ö</label>
                    <input 
                        type="tel" 
                        id="manual-block" 
                        placeholder="–ù–æ–º–µ—Ä –±–ª–æ–∫–∞"
                        inputmode="numeric"
                    >
                </div>

                <!-- –¢–ò–ü –ü–û–†–û–î–´ -->
                <div class="form-group">
                    <label>ü™® –¢–ò–ü –ü–û–†–û–î–´</label>
                    <select id="rock-type" style="width: 100%; font-size: 16px;">
                        <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø --</option>
                        <option value="520">520</option>
                        <option value="360">360</option>
                        <option value="360/520">360/520</option>
                    </select>
                </div>

                <!-- –ö–ù–û–ü–ö–ê –°–û–•–†–ê–ù–ï–ù–ò–Ø -->
                <button class="btn-primary" onclick="addManualSample()" style="width: 100%; margin-top: var(--spacing-lg);">
                    ‚úì –ó–ê–ü–ò–°–ê–¢–¨
                </button>
            </div>

            <!-- –°–ü–ò–°–û–ö –ü–†–û–ë -->
            <div class="card">
                <h2>üìã –°–ø–∏—Å–æ–∫ –ø—Ä–æ–±</h2>
                <div id="samples-list" class="empty-state">
                    <div class="empty-state-icon">üì≠</div>
                    <p>–ù–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö –ø—Ä–æ–±</p>
                </div>
            </div>

            <!-- –°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–Ø -->
            <div class="card">
                <h2>üîÑ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è</h2>
                <div class="form-group">
                    <label>URL —Å–µ—Ä–≤–µ—Ä–∞</label>
                    <input 
                        type="url" 
                        id="server-url" 
                        placeholder="https://sampling.ru"
                        value="https://sampling.ru"
                    >
                </div>
                <div class="form-group">
                    <label>API –ö–ª—é—á</label>
                    <input 
                        type="password" 
                        id="api-key" 
                        placeholder="–ö–ª—é—á –¥–æ—Å—Ç—É–ø–∞ –∫ API"
                    >
                </div>
                <div class="button-group">
                    <button class="btn-primary" onclick="syncSamples()">
                        üöÄ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å
                    </button>
                    <button class="btn-secondary" onclick="checkServer()">
                        ‚úì –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–µ—Ä–≤–µ—Ä
                    </button>
                </div>
                <div id="sync-status"></div>
                <div id="sync-progress" class="progress-bar hidden">
                    <div class="progress-fill" style="width: 0%"></div>
                </div>
            </div>

            <!-- –°–¢–ê–¢–ò–°–¢–ò–ö–ê -->
            <div class="card">
                <h2>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
                <div id="stats-container">
                    <p>–í—Å–µ–≥–æ –ø—Ä–æ–±: <strong id="total-samples">0</strong></p>
                    <p>–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ: <strong id="synced-samples">0</strong></p>
                    <p>–í –æ—á–µ—Ä–µ–¥–∏: <strong id="pending-samples">0</strong></p>
                    <p>–û–±—ä—ë–º: <strong id="storage-size">0</strong> MB</p>
                </div>
            </div>

            <!-- –≠–ö–°–ü–û–†–¢/–ò–ú–ü–û–†–¢ -->
            <div class="card">
                <h2>üíæ –†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è</h2>
                <div class="button-group">
                    <button class="btn-primary" onclick="exportData()">
                        üíæ –°–∫–∞—á–∞—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é
                    </button>
                    <button class="btn-secondary" onclick="document.getElementById('import-file').click()">
                        üìÇ –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é
                    </button>
                </div>
                <input type="file" id="import-file" accept=".json" style="display:none;" onchange="importData(event)">
                <div id="backup-status"></div>
            </div>

            <!-- –ù–ê–°–¢–†–û–ô–ö–ò -->
            <div class="card">
                <h2>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="auto-sync" onchange="saveSettings()"> 
                        –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
                    </label>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="sound-enabled" checked onchange="saveSettings()"> 
                        –ó–≤—É–∫ –ø—Ä–∏ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏
                    </label>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="vibration-enabled" checked onchange="saveSettings()"> 
                        –í–∏–±—Ä–∞—Ü–∏—è –ø—Ä–∏ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏
                    </label>
                </div>
                <div class="button-group">
                    <button class="btn-error" onclick="clearAllData()">
                        üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ
                    </button>
                </div>
            </div>
        </main>

        <footer class="footer">
            <p>Sampling App v1.0.0 | –ì–µ–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ —Ä–∞–±–æ—Ç—ã</p>
            <p style="margin-top: var(--spacing-xs);">¬© 2024-2025 | –ü–ö –∏ –º–æ–±–∏–ª—å–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞</p>
        </footer>
    </div>        <script src="https://unpkg.com/@zxing/library@latest"></script>
        <script>
        // === –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø PWA ===
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/service-worker.js')
                .then(reg => console.log('‚úì Service Worker –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω'))
                .catch(err => console.error('‚úó –û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ Service Worker:', err));
        }

        // === –£–ü–†–ê–í–õ–ï–ù–ò–ï –î–ê–ù–ù–´–ú–ò ===
        const DB_NAME = 'SamplingDB';
        const SAMPLES_STORE = 'samples';
        let db;

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è IndexedDB
        function initDB() {
            return new Promise((resolve, reject) => {
                const request = indexedDB.open(DB_NAME, 1);
                
                request.onerror = () => reject(request.error);
                request.onsuccess = () => {
                    db = request.result;
                    resolve(db);
                };
                
                request.onupgradeneeded = (e) => {
                    db = e.target.result;
                    if (!db.objectStoreNames.contains(SAMPLES_STORE)) {
                        db.createObjectStore(SAMPLES_STORE, { keyPath: 'id', autoIncrement: true });
                    }
                };
            });
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±—ã
        function addSample(sampleData) {
            return new Promise((resolve, reject) => {
                const transaction = db.transaction([SAMPLES_STORE], 'readwrite');
                const store = transaction.objectStore(SAMPLES_STORE);
                const request = store.add({
                    ...sampleData,
                    timestamp: new Date().toISOString(),
                    synced: false
                });
                
                request.onsuccess = () => {
                    playSound();
                    vibrate();
                    updateUI();
                    resolve(request.result);
                };
                request.onerror = () => reject(request.error);
            });
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –ø—Ä–æ–±
        function getAllSamples() {
            return new Promise((resolve, reject) => {
                const transaction = db.transaction([SAMPLES_STORE], 'readonly');
                const store = transaction.objectStore(SAMPLES_STORE);
                const request = store.getAll();
                
                request.onsuccess = () => resolve(request.result);
                request.onerror = () => reject(request.error);
            });
        }

        // === –£–ü–†–ê–í–õ–ï–ù–ò–ï –ö–ê–ú–ï–†–û–ô ===
        let cameraActive = false;
        let codeReader = null;
        let cameraStream = null;
        let lastScan = 0;
        const SCAN_DEBOUNCE = 1000; // 1 —Å–µ–∫ –º–µ–∂–¥—É —Å–∫–∞–Ω–∞–º–∏

        function updateCameraStatus(message, type = 'info') {
            const statusDiv = document.getElementById('camera-status');
            const colors = {
                info: 'var(--color-primary)',
                success: 'var(--color-success)',
                error: 'var(--color-error)',
                warning: 'var(--color-warning)'
            };
            statusDiv.innerHTML = `<div style="color: ${colors[type]}; font-weight: 500;">${message}</div>`;
            console.log(`[Camera ${type}]`, message);
        }

        async function requestCameraPermission() {
            updateCameraStatus('‚è≥ –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –Ω–∞ –∫–∞–º–µ—Ä—É...', 'info');
            try {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–¥–µ—Ä–∂–∫—É getUserMedia
                if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                    updateCameraStatus('‚ùå getUserMedia –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è', 'error');
                    console.error('getUserMedia –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è');
                    showManualInputOnly();
                    return;
                }

                // –î–ª—è iOS: –ø—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –º—ã –Ω–∞ HTTPS
                if (window.location.protocol !== 'https:' && window.location.hostname !== 'localhost') {
                    updateCameraStatus('‚ö†Ô∏è –ù–∞ iOS —Ç—Ä–µ–±—É–µ—Ç—Å—è HTTPS. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ https://', 'warning');
                }

                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–æ, –≤ Safari iOS —ç—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç)
                if (navigator.permissions && navigator.permissions.query) {
                    try {
                        const permission = await navigator.permissions.query({ name: 'camera' });
                        if (permission.state === 'denied') {
                            updateCameraStatus('‚ùå –î–æ—Å—Ç—É–ø –∫ –∫–∞–º–µ—Ä–µ –∑–∞–ø—Ä–µ—â—ë–Ω', 'error');
                            showManualInputOnly();
                            return;
                        }
                    } catch (e) {
                        console.log('–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ (–Ω–æ—Ä–º–∞–ª—å–Ω–æ –¥–ª—è iOS)');
                    }
                }

                // –ü–æ–ª—É—á–∞–µ–º –∫–∞–º–µ—Ä—É —Å iOS-—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–º–∏ constraints
                const constraints = {
                    video: {
                        facingMode: { ideal: 'environment' },
                        width: { max: 1280 },
                        height: { max: 720 }
                    },
                    audio: false
                };

                const stream = await navigator.mediaDevices.getUserMedia(constraints);
                cameraStream = stream;
                
                // –Ø–≤–Ω–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º srcObject –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
                const videoElement = document.getElementById('camera-video');
                videoElement.srcObject = stream;
                
                initCamera();

            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∫–∞–º–µ—Ä—ã:', error.name, error.message);
                
                if (error.name === 'NotAllowedError') {
                    updateCameraStatus('‚ùå –î–æ—Å—Ç—É–ø –æ—Ç–∫–ª–æ–Ω–µ–Ω. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –≤ –ù–∞—Å—Ç—Ä–æ–π–∫–∞—Ö', 'error');
                } else if (error.name === 'NotFoundError' || error.name === 'DevicesNotFoundError') {
                    updateCameraStatus('‚ùå –ö–∞–º–µ—Ä–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞', 'error');
                } else if (error.name === 'NotReadableError' || error.name === 'SecurityError') {
                    updateCameraStatus('‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–∫—Ä—ã—Ç—å –∫–∞–º–µ—Ä—É', 'error');
                } else if (error.name === 'OverconstrainedError') {
                    updateCameraStatus('‚ö†Ô∏è –ü–æ–ø—ã—Ç–∫–∞ —Å –º–µ–Ω—å—à–∏–º–∏ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º–∏...', 'warning');
                    trySimpleCamera();
                    return;
                } else {
                    updateCameraStatus(`‚ùå ${error.message}`, 'error');
                }
                
                showManualInputOnly();
            }
        }

        async function trySimpleCamera() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    video: true, 
                    audio: false 
                });
                cameraStream = stream;
                const videoElement = document.getElementById('camera-video');
                videoElement.srcObject = stream;
                initCamera();
            } catch (error) {
                console.error('–ö–∞–º–µ—Ä–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞:', error);
                showManualInputOnly();
            }
        }
</parameter>

        async function initCamera() {
            try {
                const videoElement = document.getElementById('camera-video');
                const loadingDiv = document.getElementById('camera-loading');

                // –£–±–µ–¥–∏–º—Å—è —á—Ç–æ video —ç–ª–µ–º–µ–Ω—Ç –≥–æ—Ç–æ–≤
                if (!videoElement) {
                    console.error('Video —ç–ª–µ–º–µ–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω');
                    showManualInputOnly();
                    return;
                }

                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–æ–≥–¥–∞ –≤–∏–¥–µ–æ –≥–æ—Ç–æ–≤–æ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—å—Å—è
                videoElement.onloadedmetadata = async () => {
                    console.log('Video ready, dimensions:', videoElement.videoWidth, 'x', videoElement.videoHeight);
                    
                    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º ZXing –ø–æ—Å–ª–µ —Ç–æ–≥–æ –∫–∞–∫ –≤–∏–¥–µ–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ
                    if (!codeReader) {
                        try {
                            codeReader = new ZXing.BrowserMultiFormatReader();
                        } catch (e) {
                            console.error('ZXing –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω:', e);
                            updateCameraStatus('‚ö†Ô∏è ZXing –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –Ω–µ –≥–æ—Ç–æ–≤–∞, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä—É—á–Ω–æ–π –≤–≤–æ–¥', 'warning');
                            cameraActive = true;
                            if (loadingDiv) loadingDiv.style.display = 'none';
                            return;
                        }
                    }

                    // –ó–∞–ø—É—Å–∫–∞–µ–º –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ
                    try {
                        codeReader.decodeFromVideoDevice(undefined, videoElement, (result, err) => {
                            if (result) {
                                const now = Date.now();
                                if (now - lastScan > SCAN_DEBOUNCE) {
                                    lastScan = now;
                                    const scannedCode = result.text.trim();
                                    document.getElementById('barcode-input').value = scannedCode;
                                    updateCameraStatus(`‚úì –û—Ç—Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω: ${scannedCode}`, 'success');
                                    playSound();
                                    vibrate();
                                }
                            }
                        });

                        cameraActive = true;
                        if (loadingDiv) loadingDiv.style.display = 'none';
                        document.getElementById('camera-toggle-btn').style.display = 'none';
                        updateCameraStatus('‚úì –ö–∞–º–µ—Ä–∞ –≥–æ—Ç–æ–≤–∞', 'success');
                    } catch (error) {
                        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è:', error);
                        updateCameraStatus('‚ö†Ô∏è –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä—É—á–Ω–æ–π –≤–≤–æ–¥', 'warning');
                        cameraActive = true;
                        if (loadingDiv) loadingDiv.style.display = 'none';
                    }
                };

                // –ï—Å–ª–∏ –≤–∏–¥–µ–æ —É–∂–µ –≥–æ—Ç–æ–≤–æ (—Ä–µ–¥–∫–æ, –Ω–æ –≤–æ–∑–º–æ–∂–Ω–æ)
                if (videoElement.videoWidth > 0) {
                    videoElement.onloadedmetadata();
                }

            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∫–∞–º–µ—Ä—ã:', error.message);
                updateCameraStatus(`‚ùå ${error.message}`, 'error');
                showManualInputOnly();
            }
        }
</parameter>

        function showManualInputOnly() {
            const videoContainer = document.getElementById('camera-container');
            const loadingDiv = document.getElementById('camera-loading');
            const videoElement = document.getElementById('camera-video');
            
            videoElement.style.display = 'none';
            if (loadingDiv) loadingDiv.style.display = 'none';
            videoContainer.style.minHeight = '60px';
            document.getElementById('camera-toggle-btn').style.display = 'block';
            document.getElementById('camera-toggle-btn').textContent = 'üì∑ –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –∫–∞–º–µ—Ä—É —Å–Ω–æ–≤–∞';
            cameraActive = false;
        }

        function stopCamera() {
            try {
                if (codeReader) {
                    codeReader.reset();
                    codeReader = null;
                }
                if (cameraStream) {
                    cameraStream.getTracks().forEach(track => track.stop());
                    cameraStream = null;
                }
                cameraActive = false;
                updateCameraStatus('–ö–∞–º–µ—Ä–∞ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞', 'info');
            } catch (e) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–µ –∫–∞–º–µ—Ä—ã:', e);
            }
        }

        function disableCamera() {
            if (cameraActive) {
                stopCamera();
            }
        }

        function enableCamera() {
            if (!cameraActive) {
                requestCameraPermission();
            }
        }

        // === –°–ö–ê–ù–ò–†–û–í–ê–ù–ò–ï –ß–ï–†–ï–ó –í–í–û–î –¢–ï–ö–°–¢–ê ===
        document.getElementById('barcode-input').addEventListener('keypress', async (e) => {
            if (e.key === 'Enter') {
                await saveBarcode();
            }
        });

        async function saveBarcode() {
            const barcode = document.getElementById('barcode-input').value.trim();
            if (!barcode) {
                alert('‚ö†Ô∏è –í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –ø—Ä–æ–±—ã');
                return;
            }

            const well = document.getElementById('manual-well').value.trim();
            const block = document.getElementById('manual-block').value.trim();
            const rockType = document.getElementById('rock-type').value;

            if (!well || !block || !rockType) {
                alert('‚ö†Ô∏è –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è: –°–∫–≤–∞–∂–∏–Ω–∞, –ë–ª–æ–∫ –∏ –¢–∏–ø –ø–æ—Ä–æ–¥—ã');
                return;
            }

            await addSample({
                uuid: barcode,
                well_name: well,
                block: block,
                type: rockType
            });

            document.getElementById('barcode-input').value = '';
            document.getElementById('barcode-input').focus();
            enableCamera();
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±—ã –∫–Ω–æ–ø–∫–æ–π
        async function addManualSample() {
            await saveBarcode();
        }

        // === –†–ï–ù–î–ï–†–ò–ù–ì ===

        // === –†–ï–ù–î–ï–†–ò–ù–ì –°–ü–ò–°–ö–ê ===
        async function renderSamples(samples = null) {
            if (!samples) {
                samples = await getAllSamples();
            }

            const list = document.getElementById('samples-list');
            if (samples.length === 0) {
                list.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üì≠</div><p>–ù–µ—Ç –ø—Ä–æ–±</p></div>';
                return;
            }

            let html = '<table class="data-table"><thead><tr>';
            html += '<th>ID</th><th>–°–∫–≤–∞–∂–∏–Ω–∞</th><th>–ë–ª–æ–∫</th><th>–¢–∏–ø</th><th>–°—Ç–∞—Ç—É—Å</th>';
            html += '</tr></thead><tbody>';

            samples.forEach(s => {
                const status = s.synced ? '‚úì' : '‚ßó';
                html += `<tr>
                    <td><small>${s.uuid.substring(0, 8)}</small></td>
                    <td>${s.well_name}</td>
                    <td>${s.block}</td>
                    <td>${s.type}</td>
                    <td>${status}</td>
                </tr>`;
            });

            html += '</tbody></table>';
            list.innerHTML = html;
        }

        // === –°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–Ø ===
        async function syncSamples() {
            const serverUrl = document.getElementById('server-url').value;
            const apiKey = document.getElementById('api-key').value;
            const statusDiv = document.getElementById('sync-status');
            const progressDiv = document.getElementById('sync-progress');

            if (!serverUrl || !apiKey) {
                statusDiv.innerHTML = '<div class="alert alert-error">–£–∫–∞–∂–∏—Ç–µ URL —Å–µ—Ä–≤–µ—Ä–∞ –∏ API –∫–ª—é—á</div>';
                return;
            }

            statusDiv.innerHTML = '<div class="alert alert-info"><div class="loading"></div> –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è...</div>';
            progressDiv.classList.remove('hidden');

            try {
                const samples = await getAllSamples();
                const toSync = samples.filter(s => !s.synced);

                for (let i = 0; i < toSync.length; i++) {
                    const sample = toSync[i];
                    const response = await fetch(`${serverUrl}/api/samples`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-API-Key': apiKey
                        },
                        body: JSON.stringify(sample)
                    });

                    if (response.ok) {
                        const transaction = db.transaction([SAMPLES_STORE], 'readwrite');
                        transaction.objectStore(SAMPLES_STORE).put({...sample, synced: true});
                    }

                    const progress = ((i + 1) / toSync.length) * 100;
                    progressDiv.querySelector('.progress-fill').style.width = progress + '%';
                }

                statusDiv.innerHTML = `<div class="alert alert-success">‚úì –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–æ ${toSync.length} –ø—Ä–æ–±</div>`;
                updateUI();
            } catch (error) {
                statusDiv.innerHTML = `<div class="alert alert-error">‚úó –û—à–∏–±–∫–∞: ${error.message}</div>`;
            }

            setTimeout(() => progressDiv.classList.add('hidden'), 2000);
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞
        async function checkServer() {
            const serverUrl = document.getElementById('server-url').value;
            const statusDiv = document.getElementById('sync-status');

            try {
                const response = await fetch(`${serverUrl}/api/health`);
                if (response.ok) {
                    statusDiv.innerHTML = '<div class="alert alert-success">‚úì –°–µ—Ä–≤–µ—Ä –¥–æ—Å—Ç—É–ø–µ–Ω</div>';
                    updateOnlineStatus(true);
                } else {
                    statusDiv.innerHTML = '<div class="alert alert-error">‚úó –°–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω</div>';
                    updateOnlineStatus(false);
                }
            } catch (error) {
                statusDiv.innerHTML = '<div class="alert alert-error">‚úó –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è</div>';
                updateOnlineStatus(false);
            }
        }

        // === –ò–ù–¢–ï–†–§–ï–ô–° ===
        async function updateUI() {
            const samples = await getAllSamples();
            const synced = samples.filter(s => s.synced).length;
            const pending = samples.length - synced;

            document.getElementById('total-samples').textContent = samples.length;
            document.getElementById('synced-samples').textContent = synced;
            document.getElementById('pending-samples').textContent = pending;

            const size = (JSON.stringify(samples).length / 1024 / 1024).toFixed(2);
            document.getElementById('storage-size').textContent = size;

            renderSamples(samples);
        }

        function updateOnlineStatus(isOnline) {
            const badge = document.getElementById('online-status');
            if (isOnline) {
                badge.textContent = '–û–Ω–ª–∞–π–Ω';
                badge.className = 'status-badge status-online';
            } else {
                badge.textContent = '–û—Ñ—Ñ–ª–∞–π–Ω';
                badge.className = 'status-badge status-offline';
            }
        }

        // === –≠–ö–°–ü–û–†–¢/–ò–ú–ü–û–†–¢ ===
        async function exportData() {
            const samples = await getAllSamples();
            const dataStr = JSON.stringify(samples, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `sampling-backup-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        async function importData(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = async (e) => {
                try {
                    const samples = JSON.parse(e.target.result);
                    const transaction = db.transaction([SAMPLES_STORE], 'readwrite');
                    const store = transaction.objectStore(SAMPLES_STORE);

                    samples.forEach(sample => {
                        store.add(sample);
                    });

                    updateUI();
                    document.getElementById('backup-status').innerHTML = 
                        `<div class="alert alert-success">‚úì –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ ${samples.length} –ø—Ä–æ–±</div>`;
                } catch (error) {
                    document.getElementById('backup-status').innerHTML = 
                        `<div class="alert alert-error">‚úó –û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞: ${error.message}</div>`;
                }
            };
            reader.readAsText(file);
        }

        // === –ó–í–£–ö –ò –í–ò–ë–†–ê–¶–ò–Ø ===
        function playSound() {
            if (!document.getElementById('sound-enabled').checked) return;
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                oscillator.frequency.value = 800;
                oscillator.type = 'sine';
                
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.1);
            } catch (e) {
                console.warn('–ó–≤—É–∫ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω');
            }
        }

        function vibrate() {
            if (!document.getElementById('vibration-enabled').checked) return;
            if ('vibrate' in navigator) {
                navigator.vibrate(100);
            }
        }

        // === –°–û–•–†–ê–ù–ï–ù–ò–ï –ù–ê–°–¢–†–û–ï–ö ===
        function saveSettings() {
            const settings = {
                autoSync: document.getElementById('auto-sync').checked,
                soundEnabled: document.getElementById('sound-enabled').checked,
                vibrationEnabled: document.getElementById('vibration-enabled').checked,
                serverUrl: document.getElementById('server-url').value,
                apiKey: document.getElementById('api-key').value
            };
            localStorage.setItem('samplingSettings', JSON.stringify(settings));
        }

        function loadSettings() {
            const settings = JSON.parse(localStorage.getItem('samplingSettings') || '{}');
            if (settings.autoSync) document.getElementById('auto-sync').checked = true;
            if (settings.soundEnabled !== false) document.getElementById('sound-enabled').checked = true;
            if (settings.vibrationEnabled !== false) document.getElementById('vibration-enabled').checked = true;
            if (settings.serverUrl) document.getElementById('server-url').value = settings.serverUrl;
            if (settings.apiKey) document.getElementById('api-key').value = settings.apiKey;
        }

        // === –û–ß–ò–°–¢–ö–ê –î–ê–ù–ù–´–• ===
        function clearAllData() {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã? –í—Å–µ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã!')) {
                indexedDB.deleteDatabase(DB_NAME);
                localStorage.clear();
                location.reload();
            }
        }

        // === –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò ===

        // === –ü–†–û–í–ï–†–ö–ê –ò–ù–¢–ï–†–ù–ï–¢–ê ===
        window.addEventListener('online', () => updateOnlineStatus(true));
        window.addEventListener('offline', () => updateOnlineStatus(false));

        // === –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ===
        document.addEventListener('DOMContentLoaded', async () => {
            await initDB();
            loadSettings();
            updateUI();
            updateOnlineStatus(navigator.onLine);
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∫–∞–º–µ—Ä—É
            setTimeout(() => {
                initCamera();
            }, 500);

            // –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º –Ω–æ–º–µ—Ä –ø—Ä–æ–±—ã - –æ—Ç–∫–ª—é—á–∞–µ–º –∫–∞–º–µ—Ä—É –ø—Ä–∏ –≤–≤–æ–¥–µ
            document.getElementById('barcode-input').addEventListener('input', (e) => {
                if (e.target.value.trim().length > 0) {
                    disableCamera();
                } else {
                    enableCamera();
                }
            });

            // –ê–≤—Ç–æ—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
            setInterval(() => {
                if (document.getElementById('auto-sync').checked && navigator.onLine) {
                    syncSamples();
                }
            }, 5 * 60 * 1000); // 5 –º–∏–Ω—É—Ç
        });
    </script>
</body>
</html>
